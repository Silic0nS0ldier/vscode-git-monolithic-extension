
if CONFIG.OS == 'linux':
    remote_file(
        name = 'pnpm',
        url = ['https://github.com/pnpm/pnpm/releases/download/v7.9.1/pnpm-linux-x64'],
        hashes = ['sha256:d1beef4238570d01cb9d85aab127ba2df17e9e9e69ce2401eb0f5744caba8836'],
        binary = True,
        out = 'pnpm',
        licences = ['MIT'],
        visibility = [':node_modules'],
    )

if CONFIG.OS == 'darwin':
    remote_file(
        name = 'pnpm',
        url = ['https://github.com/pnpm/pnpm/releases/download/v7.9.1/pnpm-macos-x64'],
        hashes = ['sha256:9b87e3272ebf3b7272fbf3961c84a943cbf78cea643ffe41b15fb24334dbe07a'],
        binary = True,
        out = 'pnpm',
        licences = ['MIT'],
        visibility = [':node_modules'],
    )

genrule(
    name = 'node_modules',
    deps = [
        '//:pnpm_config',
        '//packages/build-tools:pnpm_config',
        '//packages/extension:pnpm_config',
        '//packages/git:pnpm_config',
        '//packages/patched-ava:pnpm_config',
        '//packages/pnpm-node-resolve:pnpm_config',
    ],
    outs = [
        'node_modules',
        'packages/build-tools/node_modules',
        'packages/extension/node_modules',
        'packages/git/node_modules',
        'packages/patched-ava/node_modules',
        'packages/pnpm-node-resolve/node_modules',
    ],
    tools = {
        'pnpm': ':pnpm',
    },
    cmd = '$TOOLS_PNPM install --frozen-lockfile --ignore-scripts --package-import-method copy --store-dir ../../../../../.impure-cache/.pnpm',
    visibility = ['PUBLIC']
)